Class inherited МашинаРеквизитов.Базовые.блРедакторСИнтерфейсом "Редактор страхового случая" , editor Данные.СтраховойСлучай;

import classes Константы,ФункцииПримененияКостант,ФункцииЭлементовДанных;
import Базовый classes Константы;

--{{ Свойства

inobject public

  var Интерфейс: Данные.интСтраховойСлучай;


inobject private

--фреймы

var фреймРеквизитыФормы : TemplateFrame;
var фрейсСоставФормы : TemplateFrame;
var фреймПолучатель : TemplateFrame;
var фреймПособие : TemplateFrame;
var фреймБанк : TemplateFrame;
var фреймДопСервис : TemplateFrame;


var ПолучательПособия : ЭлементыДанных.ПолучательПособия;


--}}

--{{ Обработчики событий шаблона
proc шаблон_ПриСчитывании;
  inherited шаблон_ПриСчитывании;
  ПрочитатьПолучателяПособия;
  ВидФормы;
end;

--}}

--{{ Обработчики событий клеток шаблона

func ПолеСтрахСлучай_ПриВыводе (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): string;
  Result = '';
  if (Cell.Contents = 'ИмяСтрахСлучая') :
    return ИмяСтраховогоСлучая(ТипПособия);
  fi;
end;

func ПолеПолучателя_ПриВыводе (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): string;
  Result = '';
  if (Cell.Contents = 'ОсновныеСведенияСтрокой') :
    return ПолучательПособия.ОсновныеСведенияСтрокой;
  elsif (Cell.Contents = 'УдостоверениеСтрокой') :
    --return Получатель.Удостоверение.УдостоверениеСтрокой;
    return '';
  elsif (Cell.Contents = 'ДокументОПроживанииСтрокой') :
    --return Получатель.Удостоверение.УдостоверениеСтрокой;
    return '';
  elsif (Cell.Contents = 'АдресРегистрацииСтрокой') :
    return ПолучательПособия.АдресРегистрацииСтрокой;
  elsif (Cell.Contents = 'АдресПроживанияСтрокой') :
    return ПолучательПособия.АдресПроживанияСтрокой;
  fi;
end;




--}}

--{{ Обработчики событий прочих объектов шаблона
--}}

--{{ Дополнительные команды
--}}

--{{ Вспомогательные методы

proc ПрочитатьПолучателяПособия;
  var локПолучатель : Данные.ПолучательПособия;
  if (Self.Record.State = Created) :
     ПолучательПособия = ЭлементыДанных.ПолучательПособия.СоздатьПоЗаписиСубъекта(Субъект);
  else
    локПолучатель =  ПолучательДляСтрахСлучая (Self.Record);
    ПолучательПособия = ЭлементыДанных.ПолучательПособия.СоздатьПоЗаписиПолучателя(локПолучатель);
  fi;
end;

proc ВидФормы;
  Template.BeginModify;
    СекциинаЭкран;
  Template.EndModify;
end;

proc СекциинаЭкран;
  var локСекц : TemplateSection;
  var nstr[],i,j : integer;
    локСекц = СекцияПоИмени('секцСтрахСлучай',фреймРеквизитыФормы);
    nstr = НомераСтрокПоИменам(локСекц,['стрСтрСлуч_С_По','стрСтрСлуч_Справ','стрСтрСлуч_Рожд']);
    if (0 in nstr) :
      return;
    fi;
    for i = 1..LengthOfArray(nstr) do
      j = nstr[i];
      локСекц.Row[j].Visible = false;
    od;
    if (ТипПособия = ТипПособияБЛ) :
      j = nstr[1];
    elsif (ТипПособия = ТипПособияБерем) :
      j = nstr[1];
    elsif (ТипПособия = ТипПособияРанСрок) :
      j = nstr[2];
    elsif (ТипПособия = ТипПособияРожд) :
      j = nstr[3];
    elsif (ТипПособия = ТипПособияУходРеб) :
      j = nstr[1];
    fi;
    локСекц.Row[j].Visible = true;
end;





--}}


func Поле_ПриВыводе_ЗаголовокОкнаФормы (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): String;
  var aTxt: string[];
  with СИС2.СтроковыеФункции  do
    aTxt[1] = MarkInGray(НашеУчреждение.Наим);
    aTxt[2] = 'Cтраховой случай ' + Код + ':' + ИмяСтраховогоСлучая(ТипПособия) ;
    aTxt[3] = MarkInGray(Субъект.Имя);
    Return МассивСтрокВТекст(aTxt);
  end;
end;


end