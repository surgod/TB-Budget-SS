class inherited ћашина–еквизитов.Ѕазовые.бл–едактор—»нтерфейсом "Ѕазовый бланк-редактор дл€ за€вки на назначение пособий", editor ƒанные.«а€вкаЌаЌазначениеѕособи€;

import classes  онстанты,‘ункцииѕрименени€ остант;--,‘ункцииƒанных;

--{{ —войства

  var фреймѕолучатель :TemplateFrame;
  var фреймƒокументыѕолучател€ :TemplateFrame;
  var фреймƒокќснование :TemplateFrame;
  var фрейм–асчет :TemplateFrame;
  var фрейм¬ыплата :TemplateFrame;


inobject public

  var »нтерфейс: ƒанные.инт«а€вкаЌаЌазначениеѕособи€;


--}}


inobject private

--дополнительные сведени€

var јдрес–егистрации : Ѕазовый.—правочники.јдрес;
var јдресѕроживани€ : Ѕазовый.—правочники.јдрес;
var ”достоверениеЋичности : Ѕазовый.—правочники.”достоверение;
var ƒокументќѕравеЌаѕроживание : Ѕазовый.—правочники.”достоверение;
var ЅольничныйЋист : ƒокументы. адры.ЅольничныйЋист——;


--------------------------------------------------------------------------------
--{ ќбработчики событий бланка

proc шаблон_ѕри—оздании(Context :Variant);
  inherited шаблон_ѕри—оздании(Context);
  ќбновить—писокѕол€(фрейм¬ыплата.CellByField['—пособ¬ыплаты'], “ипы—пособов¬ыплаты‘Ћ);
  ќбновить—писокѕол€(фрейм¬ыплата.CellByField['“ип»нфо'], “ипы»нфо);
end;


proc шаблон_ѕри—читывании;
  inherited шаблон_ѕри—читывании;
  «аполнить«аписиƒоп—ведений;
end;

proc ѕоле_ѕри–исовании (Cell: TemplateCell; Selected: Logical; var Color: Integer; var FieldColor: Integer; Font: Font);
  if (Cell.Style.Name = 'ѕоле ввода'):
    if Cell.Enabled: inherited ѕри–исовании_ акѕоле¬вода (Cell, Selected, Color, FieldColor, Font);
    else             inherited ѕри–исовании_ ак«апрещенное (Cell, Selected, Color, FieldColor, Font);
    fi;
  elsif (Cell.Style.Name = 'ѕоле выбора'):
    if Cell.Enabled: inherited ѕри–исовании_ акѕоле¬ыбора (Cell, Selected, Color, FieldColor, Font);
    else             inherited ѕри–исовании_ ак«апрещенное (Cell, Selected, Color, FieldColor, Font);
    fi;
  fi;
end;


func ѕолејдрес_ѕри¬ыводе (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): Variant;
    if (Cell.Owner.Name = 'секцјдрес–ег' ) :
      return —правочники.интјдрес—оц—трах.јдрес—трокойѕо«аписи(јдрес–егистрации);
    elsif (Cell.Owner.Name = 'секцјдресѕрож' ) :
      return —правочники.интјдрес—оц—трах.јдрес—трокойѕо«аписи(јдресѕроживани€);
    fi;
end;

func ѕолеƒокументыѕолучател€_ѕри¬ыводе (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): Variant;
    if (Cell.Owner.Name = 'секц”дЋичн' ) :
      return —правочники.инт”достоверение—оц—трах.ѕолеѕо»мени(”достоверениеЋичности,Cell.Contents);
    elsif (Cell.Owner.Name = 'секцƒокѕрож' ) :
      return —правочники.инт”достоверение—оц—трах.ѕолеѕо»мени(ƒокументќѕравеЌаѕроживание,Cell.Contents);
    fi;
end;



func ѕолејдрес_ѕриЌажатии(Cell:TemplateCell; Action : Template.ClickTypes) : Logical;
  Result = false;
  if (Cell.Owner.Name = 'секцјдрес–ег' ) :
    ќткрытьјдрес–егистрации;
  elsif (Cell.Owner.Name = 'секцјдресѕрож' ) :
    if (Cell.Contents = 'ќткрыть') :
      ќткрытьјдресѕроживани€;
    elsif (Cell.Contents = '”далить') :
      ”далитьјдресѕроживани€;
    fi;
  fi;
end;

func ѕолеƒокументѕолучател€_ѕриЌажатии(Cell:TemplateCell; Action : Template.ClickTypes) : Logical;
  Result = false;
  if (Cell.Owner.Name = 'секц”дЋичн' ) :
    ќткрытьƒокументѕолучател€(”достоверениеЋичности,“ипƒокѕолуч”дЋичн);
  elsif (Cell.Owner.Name = 'секцƒокѕрож' ) :
    if (Cell.Contents = 'ќткрыть') :
      ќткрытьƒокументѕолучател€(”достоверениеЋичности,“ипƒокѕолучѕрожив);
    elsif (Cell.Contents = '—четѕолучател€') :
      ”далитьјдресѕроживани€;
    fi;
  fi;
end;


func ѕоле¬ыплата_ѕри¬ходе(Cell :TemplateCell; Index :Integer; Action : Template.EnterTypes) :Logical;
  var locForm: BlankForm;
  Result = false;
  if (Cell.Contents = 'ќткрыть') :
    “ЅЅ_Ѕазовый.Ѕиблио.¬водЌомераЅанк—чета(—четѕолучател€);
  elsif (Cell.Contents = 'Ѕ» ') :
    “ЅЅ_Ѕазовый.Ѕиблио.¬водЌомераЅик(Ѕ» );
  elsif (Cell.Contents = 'Ќомер арты') :
    locForm = Ѕюджет_«ѕиƒƒ.—лужебные.бл¬водЌомераЅанк арты.CreateEx(Ќомер арты);
    if (cmOk = locForm.ShowEx( ,Window.ModalWindow)):
      Ќомер арты = locForm.ЌомерЅанк арты as String;
    fi;
  fi;
end;




--}

--{{ ¬спомогательные методы
proc «аполнить«аписиƒоп—ведений;
  јдрес–егистрации = —правочники.интјдрес—оц—трах.јдрес–егистрацииѕо«а€вке(Self.Record);
  јдресѕроживани€ = —правочники.интјдрес—оц—трах.јдресѕроживани€ѕо«а€вке(Self.Record);
  ”достоверениеЋичности = —правочники.инт”достоверение—оц—трах.”дЋичностиѕо«а€вке(Self.Record);
  ƒокументќѕравеЌаѕроживание = —правочники.инт”достоверение—оц—трах.ƒокумќѕрживанииѕо«а€вке(Self.Record);
  if (“ипƒокќсновани€ = “ип√рƒок_ЅЋ) :
    ƒокументы. адры.интЅольничныйЋист——.ЅольничныйЋистѕо«а€вке(Self.Record);
  fi;
end;

proc ќткрытьјдрес–егистрации;
  var лок»нт : —правочники.интјдрес—оц—трах;
  if (јдрес–егистрации = nil) :
    лок»нт = —правочники.интјдрес—оц—трах.—оздатьјдрес–егистрации(Self.Record);
    if (лок»нт.Record = nil) :
      return;
    fi;
    if (CmOk = —правочники.интјдрес—оц—трах.Ѕланк–едакторѕо”молчанию.ShowFormEx(лок»нт.Record , Kernel.Window.ModalWindow)):
      јдрес–егистрации = лок»нт.Record;
    fi;
  else
    —правочники.интјдрес—оц—трах.Ѕланк–едакторѕо”молчанию.ShowFormEx(јдрес–егистрации , Kernel.Window.ModalWindow);
  fi;
end;

proc ќткрытьјдресѕроживани€;
  var лок»нт : —правочники.интјдрес—оц—трах;
  if (јдресѕроживани€ = nil) :
    лок»нт = —правочники.интјдрес—оц—трах.—оздатьјдресѕроживани€(јдрес–егистрации,Self.Record);
    if (лок»нт.Record = nil) :
      return;
    fi;
    if (CmOk = —правочники.интјдрес—оц—трах.Ѕланк–едакторѕо”молчанию.ShowFormEx(лок»нт.Record , Kernel.Window.ModalWindow)):
      јдресѕроживани€ = лок»нт.Record;
    fi;
  else
    —правочники.интјдрес—оц—трах.Ѕланк–едакторѕо”молчанию.ShowFormEx(јдресѕроживани€ , Kernel.Window.ModalWindow);
  fi;

end;


proc ”далитьјдресѕроживани€;
  if (јдресѕроживани€ = nil) :
    return;
  fi;
  if (Enquiry ( , "¬ы действительно хотите удалить адрес проживани€?",["ƒа","Ќет"]) = 1 ) :
    јдресѕроживани€.Delete;
    јдресѕроживани€ = nil;
  fi;
end;


proc ќткрытьƒокументѕолучател€ (var лок”достоверение : Ѕазовый.—правочники.”достоверение; лок“ипƒокумента : integer);
  var лок»нт : —правочники.инт”достоверение—оц—трах;
  if (лок”достоверение = nil) :
    лок»нт = —правочники.инт”достоверение—оц—трах.—оздатьѕо«а€вке»“ипу(Self.Record,лок“ипƒокумента);
    if (лок»нт.Record = nil) :
      return;
    fi;
    if (CmOk = —правочники.инт”достоверение—оц—трах.Ѕланк–едакторѕо”молчанию.ShowFormEx(лок»нт.Record , Kernel.Window.ModalWindow)):
      лок”достоверение = лок»нт.Record;
    fi;
  else
    —правочники.инт”достоверение—оц—трах.Ѕланк–едакторѕо”молчанию.ShowFormEx(лок”достоверение , Kernel.Window.ModalWindow);
  fi;
end;


proc ”далитьƒокументќѕравеЌаѕроживание;
  if (ƒокументќѕравеЌаѕроживание = nil) :
    return;
  fi;
  if (Enquiry ( , "¬ы действительно хотите удалить документ о праве на проживание?",["ƒа","Ќет"]) = 1 ) :
    ƒокументќѕравеЌаѕроживание.Delete;
    ƒокументќѕравеЌаѕроживание = nil;
  fi;
end;




--})


func ѕоле_ѕри¬ыводе_«аголовокќкна‘ормы (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): String;
  var aTxt: string[];
  with —»—2.—троковые‘ункции  do
    aTxt[1] = MarkInGray(Ќаше”чреждение.Ќаим);
    aTxt[2] = '«а€вка на назначение '+ »м€ѕособи€–од(“ипѕособи€)+' ';
    aTxt[3] = MarkInGray(' од за€вки '+  од);
    aTxt[4] = MarkInGray(—отрудник.»м€);
    Return ћассив—трок¬“екст(aTxt);
  end;
end;





end