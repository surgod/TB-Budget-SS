class inherited СИС2.БазовыйБланк "Мастер заявок на назначение пособия";

import classes Константы,ФункцииПримененияКостант;


inobject private


  var НашеУчреждение : Базовый.Данные.Субъект;
  var Сотрудник : Базовый.Данные.Субъект;
  var НазначениеПособия : Бюджет_ЗПиДД.РасчетныеОперации.НазначениеПособия;
  var ТипИнфо : integer;
  var ПричинаПерерасчета : integer;


inclass public

func CreateExt (локНашеУчреждение : Базовый.Данные.Субъект): Служебные.блНоваяЗаявкаНаНазначениеПособия;
  Result = Служебные.блНоваяЗаявкаНаНазначениеПособия.Create;
  Result.НашеУчреждение = локНашеУчреждение;
end;

func OpenForm (локНашеУчреждение : Базовый.Данные.Субъект): integer;
  var locForm: Служебные.блНоваяЗаявкаНаНазначениеПособия;
  locForm = CreateExt (локНашеУчреждение);
  if (CmOk = locForm.ShowEx( , Kernel.Window.ModalWindow)):
    Return CmOk;
  fi;
end;



--------------------------------------------------------------------------------
inobject private


var секцВвод : TemplateSection;


--{{ Обработчики событий шаблона

proc шаблон_ПриСоздании(Context :Variant);
  inherited шаблон_ПриСоздании(Context);
  ОбновитьСписокПоля(Template.CellByField['ТипИнфо'], ТипыИнфо);
  ОбновитьСписокПоля(Template.CellByField['ПричинаПерерасчета'], ТипыПричиныПерерасчета);

end;

proc шаблон_ПриОткрытии(Create :Logical);
  inherited шаблон_ПриОткрытии(Create);
  ВидФормы;
end;

--}}

--{{ Обработчики событий клеток шаблона

func Поле_ПриВыводе (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): string;
  Result = '';
  if (Cell.Contents = 'НашеУчреждение') :
    return if(НашеУчреждение <> nil : НашеУчреждение.Наим, '');
  elsif (Cell.Contents = 'Сотрудник') :
    return if(Сотрудник <> nil : Сотрудник.Наим, '');
  elsif (Cell.Contents = 'НазначениеПособия') :
    return if(НазначениеПособия <> nil : Сотрудник.Наим, '');
  fi;
end;

func Поле_ПриВходе (Cell: TemplateCell; Index: Integer; Action: Template.EnterTypes): Logical;
  var локНашеУчреждение, локСубъект[] : Базовый.Данные.Субъект;
    Result = false;
    if (Cell.Contents = 'НашеУчреждение') :
      if (CmOk = ТББ_Базовый.Библио.ВыборНашегоУчреждения(локНашеУчреждение)):
        НашеУчреждение = локНашеУчреждение;
        ВидФормы;
      fi;
    elsif (Cell.Contents = 'Сотрудник') :
      if (CmOk = ТББ_Базовый.Справочники.Субъект.картСотрудник.ВыполнитьВыбор(локСубъект,НашеУчреждение)):
        Сотрудник = локСубъект[1];
        ВидФормы;
      fi;
    elsif (Cell.Contents = 'НазначениеПособия') :
      --if (CmOk = ТББ_Базовый.Справочники.Субъект.картСотрудник.ВыполнитьВыбор(локСубъект,НашеУчреждение)):
      --  Субъект = локСубъект[1];
      --  ВидФормы;
      --fi;
    fi;
end;

proc ПолеТипПособия_ПриВыходе(Cell: TemplateCell; Index: Integer);
  кнОк.Enabled = ВсеВведено;
end;

--}}

--{{ Вспомогательные методы


proc ЗаписатьПоля;
 --СтраховойСлучай.ЗапомнитьНашеУчреждение(НашеУчреждение);
 --СтраховойСлучай.ЗапомнитьСубъект(Субъект);
 --СтраховойСлучай.ЗапомнитьТипСтрахСлучая(ТипСтрахСлучая);
end;


proc ВидФормы;
  var i : integer;
  var локВводНаше : logical;
    локВводНаше = if (НашеУчреждение <> nil : false, true);
    локВводНаше = if (локВводНаше and Сотрудник <> nil: false, локВводНаше);
    Template.BeginModify;
      for i = 1..секцВвод.RowsCount do
        if (секцВвод.Row[i].Name = 'стр_Рекв_Вывод') :
          секцВвод.Row[i].Visible = not локВводНаше;
        elsif (секцВвод.Row[i].Name = 'стр_Рекв_Ввод') :
          секцВвод.Row[i].Visible = локВводНаше;
        fi;
      end;
      кнОк.Enabled = ВсеВведено;
    Template.EndModify;
end;

func ВсеВведено : logical;
  Result = true;
  if (НашеУчреждение = nil) :
    return false;
  fi;
  if (Сотрудник = nil) :
    return false;
  fi;
  if (НазначениеПособия = nil) :
    return false;
  fi;
end;

end