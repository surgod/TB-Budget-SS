class inherited —»—2.ЅазовыйЅланк "ћастер назначени пособий";

import classes  онстанты,‘ункцииѕрименени€ остант,‘ункцииЁлементовƒанных;





inobject private

  --задаютс€ при входе

  var Ќаше”чреждение    : Ѕазовый.ƒанные.—убъект;
  var √руппаЌачислений  : string;


--{{ ¬спомогательные методы

inclass public

   func CreateExt (локЌашеучреждение: Ѕазовый.ƒанные.—убъект; лок√руппаЌачислений: string): —лужебные.бл–асчетѕособий;
     Result = —лужебные.бл–асчетѕособий.Create;
     Result.Ќаше”чреждение = локЌашеучреждение;
     Result.√руппаЌачислений = лок√руппаЌачислений;
   end;

   func OpenForm (локЌашеучреждение: Ѕазовый.ƒанные.—убъект; лок√руппаЌачислений: string): integer;
     var locForm: —лужебные.бл–асчетѕособий;
     locForm = CreateExt (локЌашеучреждение, лок√руппаЌачислений);
     if (CmOk = locForm.ShowEx( , Kernel.Window.ModalWindow)):
       Return CmOk;
     fi;
   end;

--}}

inobject private

  var фрейм¬вод: TemplateFrame;
  var фреймјктивна€—траница: TemplateFrame;
  var фреймЎаблоны—траниц: TemplateFrame;

  var кнќтмена: Button;
  var кнЌазад: Button;
  var кнƒалее: Button;


  type тип—траницаƒиалога = (стрќк = 0, стр¬ыбор÷ели, стрЅольничныйЋист, стрƒрѕособи€——);
  type тип÷ель–асчета = (тип÷ельЌет = 0, тип÷ельЅЋ, тип÷ельƒрѕос——, тип÷ельƒрѕос_Ќе_——);


  var ЌомерЎага: integer;
  var “ипјктивной—тр  : integer;
  var «аголовокЎага  : string;
  var —писов—траниц[] : integer;

  --дл€ стр¬ыбор÷ели

  var ÷ель–асчета : integer;
--------------------------------------------------------------------------------
--{ ќбработчики событий бланка

proc шаблон_ѕриќткрытии(Create :Logical);
  inherited шаблон_ѕриќткрытии(Create);
  ЌомерЎага = 1;
  —писов—траниц = [стр¬ыбор÷ели];
  “ипјктивной—тр = стр¬ыбор÷ели;
  ¬ид‘ормы;
end;

proc кнЌазад_ѕриЌажатии(B1: Button);
  ЌомерЎага = if(ЌомерЎага > 1 : ЌомерЎага - 1, ЌомерЎага);
  “ипјктивной—тр = —писов—траниц[ЌомерЎага];
  ¬ид‘ормы;
end;


proc кнƒалее_ѕриЌажатии(B1: Button);
  “ипјктивной—тр = —ледующа€—траница;
  if (“ипјктивной—тр = стрќк) :
    --«аписать;
  else
    ЌомерЎага = ЌомерЎага + 1;
    —писов—траниц[ЌомерЎага] = “ипјктивной—тр;
    ¬ид‘ормы;
  fi;
end;

proc ѕоле÷ель_ѕри–исовании (Cell: TemplateCell; Selected: Logical; var Color: Integer; var FieldColor: Integer; Font: Font);
  if (Cell.Contents = '÷ельЅЋ' and ÷ель–асчета = тип÷ельЅЋ) :
    Font.Bold = true;
  elsif (Cell.Contents = '÷ельƒрѕос——' and ÷ель–асчета = тип÷ельƒрѕос——) :
    Font.Bold = true;
  elsif (Cell.Contents = '÷ельƒрѕос_Ќе_——' and ÷ель–асчета = тип÷ельƒрѕос_Ќе_——) :
    Font.Bold = true;
  else
    Font.Bold = false;
  fi;
end;

func ѕоле÷ель_ѕри¬ыводе (Cell: TemplateCell; Value: Variant; Action: Template.OutputTypes; var Format: String): Variant;
  if (Cell.Contents = '÷ельЅЋ' and ÷ель–асчета = тип÷ельЅЋ) :
    Cell.Caption = 'l';
  elsif (Cell.Contents = '÷ельƒрѕос——' and ÷ель–асчета = тип÷ельƒрѕос——) :
    Cell.Caption = 'l';
  elsif (Cell.Contents = '÷ельƒрѕос_Ќе_——' and ÷ель–асчета = тип÷ельƒрѕос_Ќе_——) :
    Cell.Caption = '';
  fi;
end;

  func ѕоле÷ель_ѕриЌажатии (Cell: TemplateCell; Action: Template.ClickTypes): Logical;
    if (Cell.Contents = '÷ельЅЋ') :
      ÷ель–асчета = тип÷ельЅЋ;
    elsif (Cell.Contents = '÷ельƒрѕос——') :
      ÷ель–асчета = тип÷ельƒрѕос——;
    elsif (Cell.Contents = '÷ельƒрѕос_Ќе_——') :
      ÷ель–асчета = тип÷ельƒрѕос_Ќе_——;
      Cell.Caption = '';
    fi;
     нопкиЌаЁкран;
  end;



--}

--{{ ¬спомогательные методы



proc ¬ид‘ормы;
  Template.BeginModify;
    --ќчистить—ообщени€;

    if (“ипјктивной—тр = стр¬ыбор÷ели) :
      ¬ид‘ормы_¬ыбор÷ели;
    elsif (“ипјктивной—тр = стрЅольничныйЋист) :
      ¬ид‘ормы_ЅольничныйЋист;
    elsif (“ипјктивной—тр = стрƒрѕособи€——) :
      ¬ид‘ормы_ƒрѕособи€——;
    fi;
    --‘реймыЌаЁкран;
     нопкиЌаЁкран;
  Template.EndModify;
end;

proc ¬ид‘ормы_¬ыбор÷ели;
  ”далить¬се—екции(фреймјктивна€—траница);
   лонировать—екцию(фреймјктивна€—траница,'секц¬ыбор÷ели',фреймЎаблоны—траниц);
  «аголовокЎага = Str(ЌомерЎага) + ' ¬ыбор цели формироани€ пособий.';
end;

proc ¬ид‘ормы_ЅольничныйЋист;

end;

proc ¬ид‘ормы_ƒрѕособи€——;

end;

proc  нопкиЌаЁкран;
  if (ЌомерЎага = 1) :
    кнЌазад.Enabled = false;
  else
    кнЌазад.Enabled = true;
  fi;
  if (“ипјктивной—тр = стр¬ыбор÷ели) :
     нопки_¬ыбор÷ели;
  elsif (“ипјктивной—тр = стрЅольничныйЋист) :
     нопки_ЅольничныйЋист;
  elsif (“ипјктивной—тр = стрƒрѕособи€——) :
     нопки_ƒрѕособи€——;
  fi;
end;

proc  нопки_¬ыбор÷ели;
  if (÷ель–асчета =тип÷ельЌет) :
    кнƒалее.Enabled = false;
  else
    кнƒалее.Enabled = true;
  fi;
end;

proc  нопки_ЅольничныйЋист;
end;

proc  нопки_ƒрѕособи€——;
end;


func —ледующа€—траница : integer;
  Result = “ипјктивной—тр;
  if (“ипјктивной—тр = стр¬ыбор÷ели) :
    return —ледующа€—траница_¬ыбор÷ели;
  fi;
end;

func —ледующа€—траница_¬ыбор÷ели : integer;
  Result = “ипјктивной—тр;
  if (÷ель–асчета = тип÷ельЅЋ) :
    return стрЅольничныйЋист;
  elsif (÷ель–асчета = тип÷ельƒрѕос——) :
    return стрƒрѕособи€——;
  elsif (÷ель–асчета = тип÷ельƒрѕос_Ќе_——) :
    Ѕюджет_«ѕиƒƒ.—лужебные.блЌовоеЌазначениеѕособи€.OpenForm(Ќаше”чреждение,√руппаЌачислений);
    Close;
  fi;
end;




end