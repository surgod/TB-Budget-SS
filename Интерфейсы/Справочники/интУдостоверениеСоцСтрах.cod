class inherited Ѕазовый.—правочники.инт”достоверение "»нтерфейс удостоверени€ дл€ соц.страх.";

import classes  онстанты;


inclass public

  func —в€занный ласс«аписей: class —»—2.Ѕазова€.Ѕазова€«апись;
    Result = Ѕазовый.—правочники.”достоверение;
  end;

  func Create: —правочники.инт”достоверение—оц—трах;
    Result = inherited Create;
    Result.Record = Ѕазовый.—правочники.”достоверение.Create;
  end;

  func ќткрытьѕо«аписи synonym OpenRecord (locRecord: Ѕазовый.—правочники.”достоверение): —правочники.инт”достоверение—оц—трах;
    Result = inherited Create;
    Result.Record = locRecord;
  end;

  func Ѕланк–едакторѕо”молчанию: class BlankForm;
    Result = —правочники.ред”достоверение—оц—трах;
  end;

  func  артотекаѕо”молчанию: class CardForm;
    Result = —правочники.карт”достоверение—оц—трах;
  end;

----------------------------------------------------------------------------
--только дл€ соц.страх.

proc ”дЋичностиѕо”мол (лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€);
  var лок”достоверение‘Ћ : Ѕазовый.—правочники.”достоверение;
  var лок‘изЋицо : Ѕазовый.ƒанные.—убъект;
  var лок»нт : —правочники.инт”достоверение—оц—трах;
    лок‘изЋицо = лок«а€вка.—отрудник.‘изЋицо;
    лок”достоверение‘Ћ = “ЅЅ_Ѕазовый.Ѕиблио.ѕолучитьƒокумент—убъекта(лок‘изЋицо,Today);
    if (лок”достоверение‘Ћ <> nil) :
      лок»нт = —оздать опиюƒл€«а€вки»“ипа(лок”достоверение‘Ћ,лок«а€вка,“ипƒокѕолуч”дЋичности);
    else
      лок»нт = —оздатьѕо«а€вке»“ипу(лок«а€вка,“ипƒокѕолуч”дЋичности);
    fi;
    лок»нт.Record.Post;
end;

--@doc возвращает интерыейс дл€ новой записи, созданной копированием локјдрес
func —оздать опиюƒл€«а€вки»“ипа(лок”достоверение : Ѕазовый.—правочники.”достоверение;
                                лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€;
                                лок“ипƒокумента : integer) : —правочники.инт”достоверение—оц—трах;
  var локѕараметры[2] : variant;
    локѕараметры = —оздатьѕараметры«аписиѕо«а€вке»“ипу(лок«а€вка,лок“ипƒокумента);
    Result = inherited Create;
    Result.Record = лок”достоверение.Clone;
    Result.”далить‘изЋицо;
    Result.«аписатьѕараметры«а€вки»“ипа(локѕараметры);
end;

func —оздатьѕо«а€вке»“ипу(лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€;
                          лок“ипƒокумента : integer) : —правочники.инт”достоверение—оц—трах;
  var локѕараметры[2] : variant;
    локѕараметры = —оздатьѕараметры«аписиѕо«а€вке»“ипу(лок«а€вка,лок“ипƒокумента);
    Result = inherited Create;
    Result.Record = Ѕазовый.—правочники.”достоверение.Create;
    Result.”становитьѕараметрыЌовой«аписи (локѕараметры);
    Result.»нициализироватьѕо”молчанию;
end;


func ќткрытьѕо«а€вке»“ипу (лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€;
                           лок“ипƒокумента  : integer): —правочники.инт”достоверение—оц—трах;
  var лок”достоверение : Ѕазовый.—правочники.”достоверение;
    Result = nil;
    if (лок«а€вка = nil) :
      return nil;
    fi;
    лок”достоверение = Ќайтиƒокументѕо«а€вке»“ипу(лок«а€вка,лок“ипƒокумента);
    if (лок”достоверение = nil) :
      return nil;
    fi;
    Result = ќткрытьѕо«аписи(лок”достоверение);
end;




func Ќайтиƒокументѕо«а€вке»“ипу(лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€;
                                лок“ипƒокумента  : integer) : Ѕазовый.—правочники.”достоверение;
  var лок‘ильтр : string;
  var aTxt: string[];
    aTxt[1] = '«а€вкаЌаЌазначениеѕособи€ = ' + Str(лок«а€вка);
    aTxt[2] = '“ипƒокумента—оц—трах=' + Str(лок“ипƒокумента);
    лок‘ильтр = —»—2.—троковые‘ункции.—ложить—троки‘ильтраѕо»(aTxt);
    Result = —»—2.‘ункцииƒокумента.QueryRecord(Ѕазовый.—правочники.”достоверение, лок‘ильтр);
end;



func ”дЋичностиѕо«а€вке(лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€) : Ѕазовый.—правочники.”достоверение;
  var лок‘ильтр : string;
  var aTxt: string[];
    aTxt[1] = '«а€вкаЌаЌазначениеѕособи€ = ' + Str(лок«а€вка);
    aTxt[2] = '“ипƒокумента—оц—трах=' + Str(“ипƒокѕолуч”дЋичности);
    лок‘ильтр = —»—2.—троковые‘ункции.—ложить—троки‘ильтраѕо»(aTxt);
    Result = —»—2.‘ункцииƒокумента.QueryRecord(Ѕазовый.—правочники.”достоверение, лок‘ильтр);
end;

func ƒокумќѕрживанииѕо«а€вке(лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€) : Ѕазовый.—правочники.”достоверение;
  var лок‘ильтр : string;
  var aTxt: string[];
    aTxt[1] = '«а€вкаЌаЌазначениеѕособи€ = ' + Str(лок«а€вка);
    aTxt[2] = '“ипƒокумента—оц—трах=' + Str(“ипƒокѕолучѕроживание);
    лок‘ильтр = —»—2.—троковые‘ункции.—ложить—троки‘ильтраѕо»(aTxt);
    Result = —»—2.‘ункцииƒокумента.QueryRecord(Ѕазовый.—правочники.”достоверение, лок‘ильтр);
end;

func ѕолеѕо»мени(лок”достоверение : Ѕазовый.—правочники.”достоверение; лок»м€ѕол€ : string) : variant;
  Result = nil;
  if (лок”достоверение = nil) :
    return nil;
  fi;
  if (лок»м€ѕол€ = '¬идƒокумента') :
    if (лок”достоверение.¬идƒокумента = nil) :
      return '';
    else
      return лок”достоверение.¬идƒокумента.»м€;
    fi;
  else
    return  лок”достоверение.GetField(лок»м€ѕол€);
  fi;
end;

func —оздатьѕараметры«аписиѕо«а€вке»“ипу(лок«а€вка : ƒанные.«а€вкаЌаЌазначениеѕособи€;
                                         лок“ипƒокумента : integer) : variant[2];
  Result = nil;
  Result[1] = ['«а€вкаЌаЌазначениеѕособи€',лок«а€вка];
  Result[2] = ['ѕолучатель‘изЋицо',лок«а€вка.—отрудник.‘изЋицо];
  --Result[3] = ['—убъект',nil];
  Result[3] = ['“ипƒокумента—оц—трах',лок“ипƒокумента];
    --”становитьѕараметрыЌовой«аписи (локѕараметры);
    --»нициализироватьѕо”молчанию;
end;



inobject public

  Record: Ѕазовый.—правочники.”достоверение;


  --@doc ѕри создании новой записи
proc »нициализироватьѕо”молчанию synonym InitByDefault;
  inherited InitByDefault;
end;

proc «аписатьѕараметры«а€вки»“ипа(локѕараметры[2] : variant);
  var i,nn : integer;
    nn = LengthOfArray(локѕараметры);
    for i = 1..nn do
      Self.Record.SetField(локѕараметры[i,1],локѕараметры[i,2]);
    end;
end;

proc ”далить‘изЋицо;
 Self.Record.‘изЋицо = nil;
end;


func —ери€ƒокумента : string;
  return Self.Record.—ери€;
end;

func Ќомерƒокумента : string;
  return Self.Record.Ќомер;
end;

func ƒата¬ыдачиƒокумента : date;
  return Self.Record.ƒата¬ыдачи;
end;


func —ери€Ќомер_–еестр : string;
  return Self.Record.—ери€ + ',' + Self.Record.Ќомер;
end;

func Ќаименованиеƒокумента : string;
  if (Self.Record.¬идƒокумента = nil) :
    return '';
  else
    return Self.Record.¬идƒокумента.»м€;
  fi;
end;


end